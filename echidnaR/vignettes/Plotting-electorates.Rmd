---
  title: "Mapping Australia's Electorates"
author: "Di Cook, Heike Hoffman, Rob Hyndman, Ben Marwick, Carson Sievert, Nicholas Tierney, Fang Zhou."
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
%\VignetteEngine{knitr::rmarkdown}
%\VignetteEncoding{UTF-8}
---
We're interested in making a map of each electorate to see how they all voted in the last election.
We need to start with the `nat_map` and `nat_data_cart` loaded.

```{r load-read, message=FALSE, error = FALSE}
library(echidnaR)
library(dplyr)
library(ggplot2)
load("data/nat_data_cart.rda")
load("data/nat_map.rda")
```

Let's look at `nat_map` to start.

```{r, echo = FALSE}
theme_map <- theme_bw()
theme_map$line <- element_blank()
theme_map$strip.text <- element_blank()
theme_map$axis.text <- element_blank()
theme_map$plot.title <- element_blank()
theme_map$axis.title <- element_blank()
theme_map$panel.border <- element_rect(colour = "grey90", size=1, fill=NA)
```


```{r}
ggplot(data=nat_map) + geom_path(aes(x=long, y=lat, group=group, order=order)) +
  theme_map + coord_equal()
```
Now lets overlay some cartograms on the electorates. 

```{r}
ggplot(data=nat_map) +
  geom_polygon(aes(x=long, y=lat, group=group, order=order),
               fill="grey90", colour="white") +
  geom_point(data=nat_data_cart, aes(x=x, y=y), size=1, alpha=0.4) +
  theme_map + coord_equal()
```

All that's left is colouring these by the current party holding each electorate.
We're going to group the entire Liberal/National Coalition together under the colour blue.

```{r}
#Attach the electoral winners data
aes_winners <- read.csv(paste0(getwd(), "/AECdata/HouseMembersElectedDownload-17496.csv"), skip = 1)
aes_winners %>% select(DivisionNm, PartyNm) %>% 
  merge(aec_cart_join, by.x="DivisionNm", by.y="ELECT_DIV") -> cart.winners

#Grouping different Lib/Nats togethers
cart.winners$PartyNm <- as.character(cart.winners.large$PartyNm)
coalition <- c("Country Liberals (NT)", "Liberal", "Liberal National Party", "The Nationals")
cart.winners.grouped <- mutate(cart.winners, PartyNm = ifelse(as.character(PartyNm) %in% coalition,
                                                      "Liberal National Coalition", PartyNm))

#Colour cells to match that parties colours
#Order = Australian Labor Party, Independent, Katters, Lib/Nats Coalition, Palmer, The Greens
partycolours = c("#FF0000", "#000000", "#550000", "#0000FF", "#FF9900", "#00FF00")

#Plot it
ggplot(data=nat_map) +
  geom_polygon(aes(x=long, y=lat, group=group, order=order),
               fill="grey90", colour="white") +
  geom_point(data=cart.winners.grouped, aes(x=x, y=y, colour=PartyNm), size=1, alpha=0.4) +
  theme_map + coord_equal() + scale_colour_manual(name="Politcal Party", values=partycolours)

#Plot it
ggplot(data=nat_map) +
  geom_polygon(aes(x=long, y=lat, group=group, order=order),
               fill="grey90", colour="white") +
  geom_point(data=cart.winners, aes(x=x, y=y, colour=PartyNm), size=1, alpha=0.4) +
  theme_map + coord_equal() + scale_colour_manual(name="Politcal Party", values=partycolours)

```


